Целью работы была реализация системы, которая будет отслеживать перемещения игроков на видеозаписи игры в волейбол. То есть требовалось не только детектировать игроков на каждом кадре видеозаписи, но и связывать одних и тех же игроков на разных кадрах. Таким образом, появится возможность анализировать перемещение отдельного игрока с течением времени.

## Детектирование игроков
Для детектирования игроков обучил нейронную сеть архитектуры YOLOv8.
1.	Данные для обучения – кадры видеотрансляций игры в волейбол – собрал вручную из видеозаписей, доступных в сети.
2.	Разметку (выделение игроков ограничивающими прямоугольниками) проводил на Roboflow.
3.	Провел аугментацию набора данных на Roboflow. Использовал поворот изображения на небольшой угол, горизонтальное отражение, изменение яркости, размытие и зашумление.
4.	Обучил нейронную сеть. За основу взял модель yolo8s, использовал 25 эпох обучения.
5.	Оценил эффективность детектирования игроков в сравнении с предобученной нейронной сетью: значение mAP50 выросло с 0.31 до 0.98, mAP50-95 – с 0.17 до 0.70. Это связано с тем, что предобученная сеть выделяла на кадрах не только игроков, но и арбитров, тренеров, зрителей.
Пример детектирования:
![alt text](https://github.com/maksim-pasynkov/VolleyballTrackingProject/blob/master/detection_example.png) 



## Отслеживание игроков
Для реализации отслеживания выбрал алгоритм DeepSORT. Идея алгоритма заключается в следующем.
1.	Для каждого распознанного на кадре объекта рассчитываются характеристики его ограничивающего прямоугольника. По этим характеристикам фильтр Калмана предсказывает положение объекта на следующем кадре.
2.	Каждый распознанный объект передается в отдельную нейронную сеть, которая строит вектор из 128 показателей этого объекта.
3.	На следующем кадре ищется наиболее похожий по положению, предсказанному в пункте 1, и по показателям, полученным в пункте 2, объект.
Таким образом, происходит связывание объектов на соседних кадрах. При этом алгоритм позволяет хранить в памяти показатели объектов и использовать их, даже если объект исчез с видеозаписи. То есть игрок, вышедший из поля обзора камеры и затем вернувшийся обратно, может быть снова идентифицирован. Именно из-за этого выбрал DeepSORT, а не более простой и быстрый SORT.
Так как алгоритм DeepSORT работает независимо от предметной области, использовалась его готовая реализация.
Эффективность отслеживания оценил двумя метриками: MOTA – 0.95, MOTP – 0.83.
Пример отслеживания:
![alt text](https://github.com/maksim-pasynkov/VolleyballTrackingProject/blob/master/track_example.png)  

## Интерфейс
Для демонстрации работы системы написал простой интерфейс на PyQt6.
Пользователь выбирает видеозапись, запускает обработку и может просмотреть результирующую видеозапись после выделения на ней игроков и присвоения игрокам идентификаторов.
![alt text](https://github.com/maksim-pasynkov/VolleyballTrackingProject/blob/master/interface_example.png) 

## Дальнейшая работа
Сейчас основной задачей вижу доработку системы таким образом, чтобы автоматизировать сбор статистики по игрокам: кто, в какой момент и какие действия совершал (в идеале еще и результативность действия). Для этого планирую следующее.
1.	Заменить yolo8s на yolo8-pose для детектирования позы (скелета) игрока.
2.	Дополнительно детектировать мяч, сетку, игровую площадку.
3.	По скелету игрока, положению мяча, сетки и площадки классифицировать действия игрока: подача, прием, передача, атака, блок.
4.	Добавить идентификацию игроков (по номеру на форме или по лицу).
5.	Привязать систему к БД для записи данных о действиях игроков.

Другие идеи.
1.	Определять скорость перемещения игроков и мяча в качестве отдельной характеристики.
2.	Использовать программную интерполяцию кадров, чтобы сгладить резкие перемещения игроков и мяча, повысив тем самым качество отслеживания игроков.
